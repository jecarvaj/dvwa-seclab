<?php //Set where the relative IDS directory is (IDS parent folder), no leading or trailing slashes. Change this PATH.
$IDSLoc= "lib";
set_include_path(
get_include_path()
. PATH_SEPARATOR
. $IDSLoc . '/'
);
/*
if (!session_id()) {
session_start();
}
*/
//Make sure the line below is set to the right path. Change this PATH.
require_once $IDSLoc . '/IDS/Init.php';
try {
$request = array(
'REQUEST' => $_REQUEST,
'GET' => $_GET,
'POST' => $_POST,
'COOKIE' => $_COOKIE,
'SERVER' => $_SERVER["HTTP_HOST"],
//Uncomment the next line if you want to check the user agent, but you may get a lot of false positives
//'USERAGENT' => $_SERVER["HTTP_USER_AGENT"],
'ACCEPT' => $_SERVER["HTTP_ACCEPT "]

);
//By default, the config is in an insecure place where it can be downloaded, I moved it one directory up from my root web folder. Change this PATH.
$init = IDS_Init::init('/home/.giga/irongeek/Config.ini');
$init->config['General']['base_path'] = dirname(__FILE__) . '/' . $IDSLoc . '/IDS/';
$init->config['General']['use_base_path'] = true;
$init->config['Caching']['caching'] = 'none';
$ids = new IDS_Monitor($request, $init);
$result = $ids->run();
if (!$result->isEmpty()) {
//echo $result
?>
<div style="position:fixed; right:180px; bottom:10px; overflow:visible;" id="clippy">
<table valign="top" width="130" height="309" border="0" background="http://www.irongeek.com/images/clippy.png" cellpadding="10">
<tr><td valign="top"><font size="1">
&nbsp;Hello, according to <a href="http://php-ids.org/">PHPIDS</a> it looks like you are trying to pwn my site.
Would you like <a href="http://www.irongeek.com/i.php?page=videos/owasp-top-5-louisville">some help with that?</a>
</font></td></tr> </table> </div>
<?
require_once 'IDS/Log/File.php';
require_once 'IDS/Log/Composite.php';
$compositeLog = new IDS_Log_Composite();
$compositeLog->addLogger(IDS_Log_File::getInstance($init));
require_once 'IDS/Log/Email.php';
require_once 'IDS/Log/Database.php';
$compositeLog->addLogger(
IDS_Log_Email::getInstance($init),
IDS_Log_Database::getInstance($init)
);
$compositeLog->execute($result);
} else {
echo 'Alls good, in the hood.';
}
} catch (Exception $e) {
printf(
'An error occured: %s',
$e->getMessage()
);
}
?>
